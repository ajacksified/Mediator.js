(function(a,b){"use strict";"function"==typeof define&&define.amd?define([],function(){return a.Mediator=b(),a.Mediator}):"undefined"==typeof exports?a.Mediator=b():exports.Mediator=b()})(this,function(){"use strict";function a(){var a=function(){return(0|65536*(1+Math.random())).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function b(c,d,e){return this instanceof b?void(this.id=a(),this.fn=c,this.options=d,this.context=e,this.channel=null):new b(c,d,e)}function c(a,b){return this instanceof c?void(this.namespace=a||"",this._subscribers=[],this._channels={},this._parent=b,this.stopped=!1):new c(a)}function d(){return this instanceof d?void(this._channels=new c("")):new d}return b.prototype.update=function(a){a&&(this.fn=a.fn||this.fn,this.context=a.context||this.context,this.options=a.options||this.options,this.channel&&this.options&&void 0!==this.options.priority&&this.channel.setPriority(this.id,this.options.priority))},c.prototype.channelPrioritySort=function(c,a){return c.options.priority>a.options.priority?-1:c.options.priority<a.options.priority?1:0},c.prototype.addSubscriber=function(a,c,d){c||(c={priority:0}),c.priority|=0;var e=new b(a,c,d);return e.channel=this,this._subscribers.push(e),this._subscribers.sort(this.channelPrioritySort),e},c.prototype.stopPropagation=function(){this.stopped=!0},c.prototype.getSubscriber=function(a){var b=0,c=this._subscribers.length;for(b,c;b<c;b++)if(this._subscribers[b].id===a||this._subscribers[b].fn===a)return this._subscribers[b]},c.prototype.setPriority=function(a,b){for(var c=0,d=this._subscribers.length;c<d;c++)if(this._subscribers[c].id===a||this._subscribers[c].fn===a){this._subscribers[c].priority=b;break}this._subscribers.sort(this.channelPrioritySort)},c.prototype.addChannel=function(a){this._channels[a]=new c((this.namespace?this.namespace+":":"")+a,this)},c.prototype.hasChannel=function(a){return this._channels.hasOwnProperty(a)},c.prototype.returnChannel=function(a){return this._channels[a]},c.prototype.removeSubscriber=function(a,b){var c=this._subscribers.length-1;if(b="undefined"==typeof b||b,!a)this._subscribers=[];else for(c;0<=c;c--)(this._subscribers[c].fn===a||this._subscribers[c].id===a)&&(this._subscribers[c].channel=null,this._subscribers.splice(c,1));if(b&&this.autoCleanChannel(),c=this._subscribers.length-1,!a)return void(this._subscribers=[]);for(c;0<=c;c--)(this._subscribers[c].fn===a||this._subscribers[c].id===a)&&(this._subscribers[c].channel=null,this._subscribers.splice(c,1))},c.prototype.autoCleanChannel=function(){if(0===this._subscribers.length){for(var a in this._channels)if(this._channels.hasOwnProperty(a))return;if(null!=this._parent){var b=this.namespace.split(":"),c=b[b.length-1];this._parent.removeChannel(c)}}},c.prototype.removeChannel=function(a){this.hasChannel(a)&&(this._channels[a]=null,delete this._channels[a],this.autoCleanChannel())},c.prototype.publish=function(a){var b,c,d,e=0,f=this._subscribers.length,g=!1;for(e,f;e<f;e++)g=!1,b=this._subscribers[e],this.stopped||(c=this._subscribers.length,void 0!==b.options&&"function"==typeof b.options.predicate?b.options.predicate.apply(b.context,a)&&(g=!0):g=!0),g&&(b.options&&void 0!==b.options.calls&&(b.options.calls--,1>b.options.calls&&this.removeSubscriber(b.id)),b.fn.apply(b.context,a),d=this._subscribers.length,f=d,d===c-1&&e--);this._parent&&this._parent.publish(a),this.stopped=!1},d.prototype.getChannel=function(a,b){var c=this._channels,d=a.split(":"),e=0,f=d.length;if(""===a)return c;if(0<d.length)for(e,f;e<f;e++){if(!c.hasChannel(d[e]))if(b)break;else c.addChannel(d[e]);c=c.returnChannel(d[e])}return c},d.prototype.subscribe=function(a,b,c,d){var e=this.getChannel(a||"",!1);return c=c||{},d=d||{},e.addSubscriber(b,c,d)},d.prototype.once=function(a,b,c,d){return c=c||{},c.calls=1,this.subscribe(a,b,c,d)},d.prototype.getSubscriber=function(a,b){var c=this.getChannel(b||"",!0);return c.namespace===b?c.getSubscriber(a):null},d.prototype.remove=function(a,b,c){var d=this.getChannel(a||"",!0);return d.namespace===a&&void d.removeSubscriber(b,c)},d.prototype.publish=function(a){var b=this.getChannel(a||"",!1);if(b.namespace!==a)return null;var c=Array.prototype.slice.call(arguments,1);c.push(b),b.publish(c)},d.prototype.on=d.prototype.subscribe,d.prototype.bind=d.prototype.subscribe,d.prototype.emit=d.prototype.publish,d.prototype.trigger=d.prototype.publish,d.prototype.off=d.prototype.remove,d.Channel=c,d.Subscriber=b,d.version="0.11.1",d});