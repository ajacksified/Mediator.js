(function(a,b){"use strict";"function"==typeof a.exports?a.exports.Mediator=b():"function"==typeof a.define&&a.define.amd?a.define([],function(){a.Mediator=b()}):a.Mediator=b()})(this,function(){"use strict";function a(){var a=function(){return(0|65536*(1+Math.random())).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function b(c,d,e){return!this instanceof b?new b(c,d,e):(this.id=a(),this.fn=c,this.options=d,this.context=e,this.channel=null,void 0)}function c(a,b){return!this instanceof c?new c(a):(this.namespace=a||"",this._subscribers=[],this._channels=[],this._parent=b,this.stopped=!1,void 0)}function d(){return!this instanceof d?new d:(this._channels=new c(""),void 0)}return b.prototype={update:function(a){a&&(this.fn=a.fn||this.fn,this.context=a.context||this.context,this.options=a.options||this.options,this.channel&&this.options&&void 0!==this.options.priority&&this.channel.setPriority(this.id,this.options.priority))}},c.prototype={addSubscriber:function(a,c,d){var e=new b(a,c,d);return c&&void 0!==c.priority?(c.priority=c.priority>>0,0>c.priority&&(c.priority=0),c.priority>=this._subscribers.length&&(c.priority=this._subscribers.length-1),this._subscribers.splice(c.priority,0,e)):this._subscribers.push(e),e.channel=this,e},stopPropagation:function(){this.stopped=!0},getSubscriber:function(a){var b=0,c=this._subscribers.length;for(c;c>b;b++)if(this._subscribers[b].id===a||this._subscribers[b].fn===a)return this._subscribers[b]},setPriority:function(a,b){var e,f,g,h,c=0,d=0;for(d=0,h=this._subscribers.length;h>d&&this._subscribers[d].id!==a&&this._subscribers[d].fn!==a;d++)c++;e=this._subscribers[c],f=this._subscribers.slice(0,c),g=this._subscribers.slice(c+1),this._subscribers=f.concat(g),this._subscribers.splice(b,0,e)},addChannel:function(a){this._channels[a]=new c((this.namespace?this.namespace+":":"")+a,this)},hasChannel:function(a){return this._channels.hasOwnProperty(a)},returnChannel:function(a){return this._channels[a]},removeSubscriber:function(a){var c,b=0;if(c=this._subscribers.length,!a)return this._subscribers=[],void 0;for(c;c>b;c--)(this._subscribers[b].fn===a||this._subscribers[b].id===a)&&(this._subscribers[b].channel=null,this._subscribers.splice(b,1))},publish:function(a){var e,f,b=0,c=this._subscribers.length,d=!1;for(c;c>b;b++)this.stopped||(e=this._subscribers[b],void 0!==e.options&&"function"==typeof e.options.predicate?e.options.predicate.apply(e.context,a)&&(e.fn.apply(e.context,a),d=!0):(e.fn.apply(e.context,a),d=!0)),d&&e.options&&void 0!==e.options&&(e.options.calls--,1>e.options.calls?this.removeSubscriber(e.id):e.update(e.options)),b>f&&(b--,c=f);this._parent&&this._parent.publish(a),this.stopped=!1}},d.prototype={getChannel:function(a){var b=this._channels,c=a.split(":"),d=0,e=c.length;if(""===a)return b;if(c.length>0)for(e;e>d;d++)b.hasChannel(c[d])||b.addChannel(c[d]),b=b.returnChannel(c[d]);return b},subscribe:function(a,b,c,d){var e=this.getChannel(a);return c=c||{},d=d||{},e.addSubscriber(b,c,d)},once:function(a,b,c,d){return c=c||{},c.calls=1,this.subscribe(a,b,c,d)},getSubscriber:function(a,b){return this.getChannel(b||"").getSubscriber(a)},remove:function(a,b){this.getChannel(a).removeSubscriber(b)},publish:function(a){var b=Array.prototype.slice.call(arguments,1),c=this.getChannel(a);b.push(c),this.getChannel(a).publish(b)}},d.prototype.on=d.prototype.subscribe,d.prototype.bind=d.prototype.subscribe,d.prototype.emit=d.prototype.publish,d.prototype.trigger=d.prototype.publish,d.prototype.off=d.prototype.remove,d.Channel=c,d.Subscriber=b,d});
